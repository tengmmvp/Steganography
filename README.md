# BMP 图像隐写工具

## 项目简介

BMP 图像隐写工具是一款基于 C++17 实现的命令行应用，利用最低有效位（LSB）算法在 BMP 图像中嵌入和提取任意文件数据。结合 XOR 混淆加密与 CRC32 完整性校验，提供三种隐写模式和多通道选择，满足对隐蔽性与安全性高要求的场景。适用于信息安全研究、数据保密传输以及数字取证等领域。

## 设计架构

项目主要分为三大模块：

1. **BmpImage** （`BmpImage.h/.cpp`）：

   - 负责 BMP 文件格式的解析与构建，包括文件头、信息头、调色板和像素数据的读取与写入。支持 24 位和 32 位未压缩 BMP 图像，自动处理行对齐和扩展头 。

2. **StegoCore** （`StegoCore.h/.cpp`）：

   - 提供三种 LSB 隐写算法实现：顺序 LSB、随机 LSB、增强 LSB，以及辅助的 XOR 加密和 CRC32 校验功能。自动检测模式可在提取时遍历所有模式与通道组合，提高提取成功率 。

3. **主程序** （`main.cpp`）：

   - 实现用户交互、参数配置和流程控制。基于 ANSI 转义序列提供彩色输出，可在支持的终端获得更友好的操作体验 。

## 核心功能

- **多格式支持**：24 位、32 位 BMP 图像读写
- **三种隐写模式**：
  - 顺序 LSB（1 bit/通道，最大容量）
  - 随机 LSB（1 bit/通道，基于密码随机分布）
  - 增强 LSB（2 bit/通道，容量与隐蔽性平衡）
- **通道自由组合**：可按掩码选择蓝／绿／红通道进行数据嵌入
- **数据加密与校验**：XOR 混淆增强安全性；CRC32 保证完整性
- **自动检测提取**：遍历全部模式与通道，提高提取命中率
- **纯标准库实现**：无第三方依赖，跨平台兼容 Windows、Linux、macOS

## 环境与依赖

- 操作系统：Windows 10/11、Linux、macOS
- 编译器：支持 C++17 的编译器（如 g++ 9+、clang 9+、MSVC 2019+）
- 终端：支持 ANSI 转义序列（可选彩色输出），若不支持可注释 `ConsoleColor` 定义以禁用彩色

## 编译指南

### 直接编译（推荐）

```bash
g++ -std=c++17 main.cpp BmpImage.cpp StegoCore.cpp -O2 -o StegoTool
```

### 使用 CMake

```bash
git clone <repo_url> && cd <repo>
mkdir build && cd build
cmake -DCMAKE_BUILD_TYPE=Release ..
make
```

构建完成后，执行文件位于 `build/StegoTool`

## 使用说明

### 启动程序

```bash
./StegoTool
```

### 主菜单操作

```
1. 隐藏数据到 BMP 图像
2. 提取 BMP 图像中的数据
3. 配置隐写参数
4. 退出
```

### 数据隐藏示例

1. 选择 `1` 并回车
2. 配置模式、通道和密码（可留空跳过加密）
3. 输入待处理的 BMP 文件路径，回车
4. 输入要隐藏的文件路径，回车
5. 输入输出 BMP 文件路径，回车
6. 程序显示成功提示并生成隐写图像

### 数据提取示例

1. 选择 `2` 并回车
2. 配置同样的模式与密码，或启用自动检测
3. 输入含隐写数据的 BMP 文件路径，回车
4. 输入提取后数据的保存路径，回车
5. 程序显示提取字节数并保存文件

## 高级配置

- **ConsoleColor**：在 `main.cpp` 中定义，可修改或移除相关常量以关闭彩色输出
- **CRC32 多项式**：在 `StegoCore.cpp` 中的 `crcTable` 基于 `0xEDB88320`，可按需替换
- **隐写容量计算**：参考 `StegoCore::calculateCapacity`，根据图像大小和通道位数动态计算最大可用容量

## 容量与性能

- **最大嵌入容量** = 圆下：
  ```text
  容量(字节) ≈ (像素数 × 通道数 × bit_per_channel) / 8 - 16
  ```
  其中 `-16` 是 `StegoHeader` 头部大小。
- **性能优化**：O(n) 级别位操作，轻量高效，适合大文件处理。

## 常见问题

- **无法打开或识别 BMP**：\
  确认文件为未压缩的 BMP；24 位或 32 位；路径正确。
- **提取失败或数据损坏**：\
  核对加密密码、隐写模式及通道掩码；尝试启用自动检测。
- **彩色输出异常字符**：\
  终端不支持 ANSI。请使用支持 ANSI 的终端，或关闭彩色输出。
- **容量不足警告**：\
  请更换更大尺寸的 BMP 或切换至增强模式提升容量。

## 项目结构

```
├── CMakeLists.txt      # CMake 构建脚本（可选）
├── main.cpp            # 程序入口与命令行界面
├── BmpImage.h/.cpp     # BMP 文件读写模块
└── StegoCore.h/.cpp    # 隐写算法核心模块
```

## 许可证

本项目采用 MIT 许可证，详见 `LICENSE`。